(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2982],{52884:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user/wallet",function(){return s(10807)}])},70525:function(e,t,s){"use strict";s.d(t,{Z:function(){return p}});var a=s(85893),n=s(67294),i=s(58589),l=s(98842),r=s(25062),c=s(4683),o=s(38824),d=s(77424),h=s(41664),u=s.n(h),m=s(25675),x=s.n(m);function p(e){let{role:t}=e,[s,h]=(0,n.useState)([]),[m,p]=(0,n.useState)(0);(0,n.useEffect)(()=>{j()},[]);let j=async()=>{try{let e=localStorage.getItem("token"),t=await fetch("/api/notifications",{headers:{Authorization:"Bearer ".concat(e)}}),s=await t.json();s.success&&(h(s.data),p(s.data.filter(e=>!e.isRead).length))}catch(e){console.error("Error fetching notifications:",e)}};return(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(l.Z,{nav:!0,className:"position-relative",children:[(0,a.jsx)(d.Z,{size:20}),m>0&&(0,a.jsx)(r.Z,{color:"danger",pill:!0,className:"position-absolute",style:{top:"-5px",right:"-5px"},children:m})]}),(0,a.jsxs)(c.Z,{end:!0,className:"notification-dropdown p-0",style:{width:"320px",maxHeight:"400px"},children:[(0,a.jsxs)("div",{className:"p-2 border-bottom d-flex justify-content-between align-items-center",children:[(0,a.jsx)("h6",{className:"mb-0",children:"Notifications"}),(0,a.jsx)(u(),{href:t?"/".concat(t,"/notifications"):"/user/notifications",className:"text-muted small",children:"View All"})]}),(0,a.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto"},children:0===s.length?(0,a.jsx)(o.Z,{text:!0,children:"No notifications"}):s.slice(0,5).map(e=>(0,a.jsx)(o.Z,{className:"border-bottom",children:(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)(x(),{src:"/user1.png",alt:"User",width:40,height:40,className:"rounded-circle me-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"fw-bold",children:e.title}),(0,a.jsx)("small",{className:"text-muted",children:new Date(e.createdAt).toLocaleString()})]})]})},e._id))})]})]})}},73796:function(e,t,s){"use strict";s.d(t,{Z:function(){return P}});var a=s(85893),n=s(67294),i=s(79862),l=s(84082),r=s(35510),c=s(16987),o=s(58589),d=s(98842),h=s(4683),u=s(38824),m=s(11163),x=s(45007),p=s(44109),j=s(25675),f=s.n(j),w=s(25471),v=s(38571),g=s(39646),b=s(17207),y=s(83220),N=s(81912),S=s(77662),Z=s(48903),C=s(27434),F=s(4868),k=s(41664),A=s.n(k),E=s(70525),D=s(33299);function P(e){var t,s,j,k,P,_;let{children:z}=e,I=(0,m.useRouter)(),T=(0,x.I0)(),[W,O]=(0,n.useState)(!0),B=(0,D.useSession)(),U=[{text:"Dashboard",path:"/user/dashboard",icon:(0,a.jsx)(w.Z,{size:18})},{text:"Tournaments",path:"/user/dashboard/tournaments",icon:(0,a.jsx)(v.Z,{size:18})},{text:"Friends",path:"/user/friends",icon:(0,a.jsx)(g.Z,{size:18})},{text:"Statistics",path:"/user/statistics",icon:(0,a.jsx)(b.Z,{size:18})},{text:"Wallet",path:"/user/wallet",icon:(0,a.jsx)(y.Z,{size:18})},{text:"Chat",path:"/chat",icon:(0,a.jsx)(N.Z,{size:18})},{text:"Settings",path:"/user/settings",icon:(0,a.jsx)(S.Z,{size:18})}];return(0,a.jsxs)("div",{className:"d-flex",children:[(0,a.jsxs)(i.Z,{vertical:!0,className:"bg-white border-end sidebar ".concat(W?"open":""),style:{width:W?"240px":"64px",height:"100vh",position:"fixed",left:0,top:0,zIndex:1030,transition:"all 0.3s ease-in-out"},children:[(0,a.jsx)("div",{className:"p-3 d-flex align-items-center mb-2",children:(0,a.jsxs)("div",{className:"d-flex w-100 align-items-center justify-content-between",children:[W&&(0,a.jsx)(f(),{src:"/axiom-logo.png",alt:"Axiom",width:70,height:45}),(0,a.jsx)(l.Z,{className:"p-0",color:"initial",onClick:()=>O(!W),children:(0,a.jsx)(Z.Z,{size:24,style:{transform:W?"rotate(0deg)":"rotate(180deg)",transition:"transform 0.3s ease-in-out"}})})]})}),U.map(e=>(0,a.jsx)(r.Z,{children:(0,a.jsxs)(A(),{href:e.path,className:"d-flex align-items-center mb-2 px-3 py-2 ".concat(I.pathname===e.path?"bg-warning text-dark":"text-muted"),style:{textDecoration:"none"},children:[e.icon,W&&(0,a.jsx)("span",{className:"ms-2",children:e.text})]})},e.text))]}),(0,a.jsxs)("div",{style:{marginLeft:W?"240px":"64px",transition:"margin-left 0.3s ease-in-out",width:"100%"},children:[(0,a.jsx)(c.Z,{className:"bg-white border-bottom px-4",container:!1,children:(0,a.jsx)(i.Z,{className:"ms-auto d-flex align-items-center",navbar:!0,children:(0,a.jsxs)("div",{className:"d-flex align-items-center me-3",children:[(0,a.jsx)(E.Z,{})," ",(0,a.jsxs)(o.Z,{inNavbar:!0,nav:!0,className:"ms-3",children:[(0,a.jsxs)(d.Z,{nav:!0,children:[(0,a.jsx)(f(),{src:null!==(_=null===(t=B.data)||void 0===t?void 0:t.user.profileImage)&&void 0!==_?_:"/profile-avatar.png",alt:null===(j=B.data)||void 0===j?void 0:null===(s=j.user)||void 0===s?void 0:s.name,width:32,height:32,className:"rounded-circle me-2"}),null===(P=B.data)||void 0===P?void 0:null===(k=P.user)||void 0===k?void 0:k.name," ",(0,a.jsx)(C.Z,{size:16})]}),(0,a.jsx)(h.Z,{end:!0,className:"position-absolute",children:(0,a.jsxs)(u.Z,{onClick:()=>{T((0,p.kS)()),(0,D.signOut)({redirect:!1}).then(()=>I.push("/auth/login"))},children:[(0,a.jsx)(F.Z,{size:14,className:"me-2"}),"Logout"]})})]})]})})}),(0,a.jsx)("main",{className:"p-4",children:z})]})]})}},10807:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return S}});var a=s(85893),n=s(67294),i=s(53637),l=s(79862),r=s(35510),c=s(81051),o=s(81780),d=s(33073),h=s(35773),u=s(95305),m=s(39886),x=s(54610),p=s(84082),j=s(4991),f=s(95719),w=s(83024),v=s(60766),g=s(73796),b=s(2859),y=s(86664);let N=e=>{let{clientSecret:t,amount:s}=e,i=(0,y.useStripe)(),l=(0,y.useElements)(),[r,c]=(0,n.useState)(!1),[o,d]=(0,n.useState)(null),h=async e=>{try{let a=await fetch("/api/wallet/deposit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(s),paymentIntentId:e.id})}),n=await a.json();if(a.ok&&n.success){var t;d(null);let e=document.createElement("div");e.className="alert alert-success",e.textContent="Payment successful! Your funds have been added.",null===(t=document.querySelector("form"))||void 0===t||t.prepend(e);let[s,a]=await Promise.all([fetch("/api/stripe/connect/status"),fetch("/api/wallet/balance")]),[n,i]=await Promise.all([s.json(),a.json()]);n.success&&window.dispatchEvent(new CustomEvent("walletUpdate",{detail:{stripeBalance:n.balance,walletBalance:i.balance}})),setTimeout(()=>{window.location.reload()},2e3)}else d("Failed to update wallet balance after successful payment.")}catch(e){d("Failed to process payment successfully.")}},u=async e=>{if(e.preventDefault(),!i||!l||r)return;c(!0),d(null);let s=l.getElement(y.CardElement);if(s)try{let{error:e,paymentIntent:a}=await i.confirmCardPayment(t,{payment_method:{card:s,billing_details:{name:"Wallet Deposit"}}});if(e){console.error("Payment error:",e),d(e.message||"Payment failed"),c(!1);return}if(!a||"succeeded"!==a.status){d("Payment was not successful"),c(!1);return}await h(a)}catch(e){d("An error occurred during payment")}finally{c(!1)}};return(0,a.jsxs)("form",{onSubmit:u,children:[(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("label",{className:"form-label",children:"Amount to Deposit ($)"})}),(0,a.jsx)("div",{className:"mb-3 border p-3 rounded",children:(0,a.jsx)(y.CardElement,{})}),(0,a.jsx)(p.Z,{type:"submit",color:"warning",disabled:!i||r,className:"w-100",children:r?"Processing...":"Deposit Funds"}),o&&(0,a.jsx)("div",{className:"text-danger mt-2",children:o})]})};function S(){let[e,t]=(0,n.useState)(0),[s,S]=(0,n.useState)(null),[Z,C]=(0,n.useState)(""),[F,k]=(0,n.useState)(!1),[A,E]=(0,n.useState)([]),[D,P]=(0,n.useState)("deposit"),[_,z]=(0,n.useState)(null),[I,T]=(0,n.useState)(null),[W,O]=(0,n.useState)(""),[B,U]=(0,n.useState)(!1),[$,L]=(0,n.useState)(null),[H,J]=(0,n.useState)(0);(0,n.useEffect)(()=>{S((0,b.J)("pk_test_51M2jnQGXo0yETosuhaxfDG4zr9SyrhBFs9Pq9v7jSP665hJxrmmsSJfVEFuffQHc3y2zGkkRqOLKKbeIqAeuQ6CU00iolgzSmQ")),q(),R(),G();let e=e=>{J(e.detail.stripeBalance),t(e.detail.walletBalance)};return window.addEventListener("walletUpdate",e),()=>{window.removeEventListener("walletUpdate",e)}},[]);let q=async()=>{let e=await fetch("/api/wallet/balance"),s=await e.json();s.success&&t(s.balance)},R=async()=>{let e=await fetch("/api/wallet/history"),t=await e.json();t.success&&E(t.history)},G=async()=>{try{let e=await fetch("/api/stripe/connect/status"),t=await e.json();t.success&&(L(t.status),J(t.balance))}catch(e){console.error("Error fetching Stripe status:",e)}},[Q,Y]=(0,n.useState)(""),[X,K]=(0,n.useState)(!1),V=async()=>{try{if(!Q||0>=parseFloat(Q)){alert("Please enter a valid amount");return}K(!1),C("");let e=await fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Number(Q)})}),t=await e.json();if(!e.ok)throw Error(t.message||"Failed to create payment");if(!t.clientSecret)throw Error("No client secret received");C(t.clientSecret),K(!0)}catch(e){console.error("Payment intent error:",e),alert(e.message||"Failed to process payment"),K(!1)}},[M,ee]=(0,n.useState)(""),[et,es]=(0,n.useState)(!1),ea=async()=>{try{if(ee(""),es(!0),!$){ee("Please connect your Stripe account first");return}if("active"!==$){ee("Your Stripe account needs to be fully verified");return}let s=parseFloat(W);if(!s||s<=0){ee("Please enter a valid amount");return}if(s>e){ee("Insufficient funds");return}let a=await fetch("/api/wallet/withdraw",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:s})}),n=await a.json();a.ok?(alert("Withdrawal successful! Funds have been transferred to your Stripe account."),t(e=>e-s),O(""),q()):ee(n.message||"Failed to process withdrawal")}catch(e){console.error("Withdrawal error:",e),ee(e.message||"Failed to process withdrawal")}finally{es(!1)}},en=async()=>{U(!0);try{let e=await fetch("/api/stripe/connect/onboard",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json();throw Error(t.message||"Failed to initialize Stripe Connect")}let t=await e.json();if(t.success&&t.url)window.location.href=t.url;else throw Error("Invalid response from server")}catch(e){console.error("Error connecting Stripe:",e),alert(e.message||"Failed to connect Stripe account")}finally{U(!1)}},ei=e=>{D!==e&&P(e)};return(0,a.jsx)(g.Z,{children:(0,a.jsxs)(i.Z,{fluid:!0,className:"p-4",children:[(0,a.jsxs)(l.Z,{tabs:!0,children:[(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{className:"deposit"===D?"active":"",onClick:()=>{ei("deposit")},children:"Deposit"})}),(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{className:"stripe-wallet"===D?"active":"",onClick:()=>{ei("stripe-wallet")},children:"Stripe Wallet"})}),(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{className:"withdraw"===D?"active":"",onClick:()=>{ei("withdraw")},children:"Withdraw"})}),(0,a.jsx)(r.Z,{children:(0,a.jsx)(c.Z,{className:"connect"===D?"active":"",onClick:()=>{ei("connect")},children:"Connect Account"})})]}),(0,a.jsxs)(o.Z,{activeTab:D,children:[(0,a.jsxs)(d.Z,{tabId:"deposit",children:[(0,a.jsx)(h.Z,{children:(0,a.jsxs)(u.Z,{md:8,children:[(0,a.jsx)(m.Z,{className:"mb-4",children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)("h4",{children:"Axiom Wallet"}),(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{children:["$",e.toFixed(2)]}),(0,a.jsx)("small",{className:"text-muted",children:"Available Balance"})]}),(0,a.jsx)(p.Z,{color:"warning",onClick:()=>{k(!0),K(!1),Y("")},children:"Deposit"})]})]})}),(0,a.jsx)(m.Z,{children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)("h5",{children:"Deposit History"}),(0,a.jsxs)(j.Z,{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Date"}),(0,a.jsx)("th",{children:"Amount"}),(0,a.jsx)("th",{children:"Status"})]})}),(0,a.jsx)("tbody",{children:A.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("td",{children:["$",e.amount.toFixed(2)]}),(0,a.jsx)("td",{children:e.status})]},e._id))})]})]})})]})}),(0,a.jsxs)(f.Z,{isOpen:F,toggle:()=>k(!1),children:[(0,a.jsx)(w.Z,{toggle:()=>k(!1),children:"Deposit Funds"}),(0,a.jsx)(v.Z,{children:X?s&&Z&&(0,a.jsx)(y.Elements,{stripe:s,options:{clientSecret:Z},children:(0,a.jsx)(N,{clientSecret:Z,amount:Q})}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"form-group mb-3",children:[(0,a.jsx)("label",{children:"Amount to Deposit ($)"}),(0,a.jsx)("input",{type:"number",className:"form-control",value:Q,onChange:e=>Y(e.target.value),min:"1",required:!0})]}),(0,a.jsx)(p.Z,{color:"primary",onClick:V,children:"Next"})]})})]})]}),(0,a.jsx)(d.Z,{tabId:"withdraw",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h5",{children:"Withdraw Funds"}),(0,a.jsx)(m.Z,{className:"mb-4",children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{children:["$",e.toFixed(2)]}),(0,a.jsx)("small",{className:"text-muted",children:"Available Balance in Axiom Wallet"})]})}),"active"===$?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Amount to Withdraw ($)"}),(0,a.jsx)("input",{type:"number",className:"form-control",value:W,onChange:e=>O(e.target.value),max:e,min:1})]}),(0,a.jsx)(p.Z,{color:"warning",onClick:ea,disabled:!W||parseFloat(W)>e||0>=parseFloat(W),children:"Withdraw to Stripe Account"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-warning mb-3",children:"Please connect your Stripe account first to withdraw funds."}),(0,a.jsx)(p.Z,{color:"primary",onClick:()=>ei("connect"),children:"Connect Stripe Account"})]})]})})]})}),(0,a.jsx)(d.Z,{tabId:"stripe-wallet",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h5",{children:"Add Funds to Stripe Wallet"}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("p",{children:["Current Stripe Balance: $",H.toFixed(2)]})}),(0,a.jsx)(m.Z,{className:"mt-4",children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)("h5",{children:"Stripe Deposit History"}),(0,a.jsxs)(j.Z,{responsive:!0,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Date"}),(0,a.jsx)("th",{children:"Amount"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Transaction ID"})]})}),(0,a.jsx)("tbody",{children:A.filter(e=>"completed"===e.status).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("td",{children:["$",e.amount.toFixed(2)]}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"badge bg-success",children:e.status})}),(0,a.jsx)("td",{children:(0,a.jsx)("small",{className:"text-muted",children:e.paymentIntentId})})]},e._id))})]})]})}),"active"===$?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Amount to Add ($)"}),(0,a.jsx)("input",{type:"number",className:"form-control",value:Q,onChange:e=>Y(e.target.value),min:"1",style:{maxWidth:"300px"}})]}),X?s&&Z&&(0,a.jsx)(y.Elements,{stripe:s,options:{clientSecret:Z},children:(0,a.jsx)(N,{clientSecret:Z,amount:Q})}):(0,a.jsx)(p.Z,{color:"warning",onClick:V,children:"Add Funds"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-warning",children:"Please connect your Stripe account first to add funds."}),(0,a.jsx)(p.Z,{color:"primary",onClick:()=>ei("connect"),children:"Go to Connect Account"})]})]})}),(0,a.jsx)(d.Z,{tabId:"connect",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h5",{children:"Connect Your Stripe Account"}),(0,a.jsx)("p",{children:"Connect your Stripe account to receive withdrawals"}),(0,a.jsx)(p.Z,{color:"primary",onClick:en,disabled:B||"active"===$,children:B?"Connecting...":"active"===$?"Connected with Stripe":"Connect with Stripe"}),$&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("p",{children:["Stripe Account Status: ",$]}),(0,a.jsxs)("p",{children:["Stripe Balance: $",H.toFixed(2)]}),"active"===$&&(0,a.jsx)(p.Z,{color:"danger",className:"mt-3",onClick:async()=>{if(window.confirm("Are you sure you want to disconnect your Stripe account?"))try{if((await fetch("/api/stripe/connect/disconnect",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)L(null),J(0),alert("Stripe account disconnected successfully");else throw Error("Failed to disconnect Stripe account")}catch(e){console.error("Disconnect error:",e),alert(e.message||"Failed to disconnect Stripe account")}},children:"Disconnect Stripe Account"})]})]})}),(0,a.jsx)(d.Z,{tabId:"screenshot",children:(0,a.jsx)(h.Z,{children:(0,a.jsx)(u.Z,{md:8,children:(0,a.jsx)(m.Z,{className:"mb-4",children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)("h4",{className:"mb-4",children:"Upload Screenshot"}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){z(s);let e=new FileReader;e.onload=e=>{var t;T(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(s)}},className:"form-control"})}),I&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("img",{src:I,alt:"Preview",style:{maxWidth:"100%",maxHeight:"400px"},className:"rounded"})}),(0,a.jsx)(p.Z,{color:"warning",onClick:()=>{console.log("Uploading:",_),alert("Screenshot Uploaded!"),z(null),T(null)},disabled:!_,style:{backgroundColor:"#FFD600",borderColor:"#FFD600"},children:"Upload Screenshot"})]})})})})})]})]})})}}},function(e){e.O(0,[9594,1664,5714,8662,5719,693,8251,6203,2888,9774,179],function(){return e(e.s=52884)}),_N_E=e.O()}]);