exports.id=8397,exports.ids=[8397],exports.modules={59410:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>m});var s=r(20997),i=r(16689),n=r(41869),o=r(80594),l=r(4300),c=r(4730),d=r(2083),p=r(82576),u=r(91291),h=e([o]);function m({peerConnection:e,localStream:t,remoteStream:r,isVideo:a,onEndCall:h,onToggleVideo:m,onToggleAudio:x}){let y=(0,i.useRef)(null),f=(0,i.useRef)(null),[g,v]=(0,i.useState)(a),[j,S]=(0,i.useState)(!0);return(0,s.jsxs)(n.Z,{sx:{width:"100%",height:"100%",position:"relative"},children:[(0,s.jsxs)(n.Z,{sx:{display:"flex",height:"100%"},children:[r&&s.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),t&&s.jsx("video",{ref:y,autoPlay:!0,playsInline:!0,muted:!0,style:{position:"absolute",width:"150px",height:"150px",bottom:80,right:20,objectFit:"cover",borderRadius:"8px"}})]}),(0,s.jsxs)(n.Z,{sx:{position:"absolute",bottom:20,left:"50%",transform:"translateX(-50%)",display:"flex",gap:2,backgroundColor:"rgba(0,0,0,0.5)",padding:2,borderRadius:4},children:[s.jsx(o.Z,{onClick:()=>{v(!g),m()},color:"primary",children:g?s.jsx(l.Z,{}):s.jsx(c.Z,{})}),s.jsx(o.Z,{onClick:()=>{S(!j),x()},color:"primary",children:j?s.jsx(d.Z,{}):s.jsx(p.Z,{})}),s.jsx(o.Z,{onClick:h,color:"error",children:s.jsx(u.Z,{})})]})]})}o=(h.then?(await h)():h)[0],a()}catch(e){a(e)}})},22561:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>$});var s=r(20997),i=r(16689),n=r(41869),o=r(69216),l=r(58046),c=r(73173),d=r(20166),p=r(80594),u=r(51642),h=r(64731),m=r.n(h),x=r(98416),y=r.n(x),f=r(46088),g=r.n(f),v=r(60858),j=r.n(v),S=r(14612),Z=r(25675),w=r.n(Z),b=r(27351),k=r(9530),C=r(52081),T=r.n(C),I=r(68214),R=r.n(I),L=r(59410),M=r(87983),E=e([S,L,o,l,c,d,p,u]);function $({currentUser:e,receiver:t}){let[r,a]=(0,i.useState)([]),[h,x]=(0,i.useState)(""),[f,v]=(0,i.useState)(!0),[S,Z]=(0,i.useState)([]),[C,I]=(0,i.useState)(!1),[E,$]=(0,i.useState)(0),[z,D]=(0,i.useState)(null),P=(0,i.useRef)(null),U=(0,i.useRef)(null),_=(0,i.useRef)(null),N=(0,i.useRef)(null),V=[e._id,t._id].sort().join("-"),A=(0,M.Z)(),O=async()=>{},W=()=>{z&&(z.stop(),I(!1),_.current&&clearInterval(_.current))},H=async r=>{if(r.preventDefault(),h.trim()||S)try{let r=new FormData;r.append("sender",e._id),r.append("receiver",t._id),r.append("roomId",[e._id,t._id].sort().join("-")),h.trim()&&r.append("content",h),S&&S.forEach(e=>{r.append("files",e)});let a=await fetch("/api/chat",{method:"POST",body:r});if(a.ok){let e=await a.json();N.current.emit("message",e.data),x(""),Z([]),P.current&&(P.current.value="")}}catch(e){console.error("Error sending message:",e)}},[B,F]=(0,i.useState)(null),[G,J]=(0,i.useState)(null),[q,X]=(0,i.useState)(!1),Y=async r=>{try{let a=await navigator.mediaDevices.getUserMedia({audio:!1,video:r});for(let e of(F(a),a.getTracks()))A.peer.addTrack(e,a);A.peer.onicecandidate=r=>{r.candidate&&N.current.emit("ice-candidate",{candidate:r.candidate,to:t._id,from:e._id,roomId:V})};let s=await A.getOffer();N.current.emit("call-offer",{offer:s,to:t._id,from:e._id,roomId:V}),X(!0)}catch(e){console.error("Error starting call:",e),alert("Failed to start call. Please check your camera/microphone permissions.")}};return f?s.jsx(n.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:s.jsx(d.Z,{})}):(0,s.jsxs)(n.Z,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[q&&s.jsx(n.Z,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e3},children:s.jsx(L.Z,{peerConnection:A.peer,localStream:B,remoteStream:G,isVideo:!0,onEndCall:()=>{B&&(console.log("close"),B.getTracks().forEach(e=>e.stop()),F(null)),A.peer&&A.peer.close(),J(null),X(!1)},onToggleVideo:()=>{if(B){let e=B.getVideoTracks()[0];e&&(e.enabled=!e.enabled)}},onToggleAudio:()=>{if(B){let e=B.getAudioTracks()[0];e&&(e.enabled=!e.enabled)}}})}),s.jsx(n.Z,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:s.jsx(l.Z,{variant:"h6",children:t.name})}),(0,s.jsxs)(n.Z,{sx:{flexGrow:1,overflow:"auto",p:2},children:[r.map(t=>{let r=t.sender===e._id;return s.jsx(n.Z,{sx:{display:"flex",justifyContent:r?"flex-end":"flex-start",mb:2},children:(0,s.jsxs)(o.Z,{sx:{p:2,maxWidth:"70%",bgcolor:r?"primary.main":"grey.100",color:r?"white":"text.primary"},children:[t.content&&s.jsx(l.Z,{sx:{mb:t.fileUrl?1:0},children:t.content}),t?.media&&t.media.length>0?s.jsx("div",{className:"d-flex flex-wrap mt-2",children:t.media.map(e=>e.fileType.includes("audio")?s.jsx("audio",{src:e.fileUrl,controls:!0}):e.fileType.includes("image")?s.jsx(w(),{alt:e.fileName,src:e.fileUrl,width:200,height:100,className:"me-2 mb-2"}):e.fileType.includes("video")?s.jsx("video",{src:e.fileUrl,controls:!0,style:{width:"300px",height:"200px"}}):null)}):null,t.fileUrl&&s.jsx(n.Z,{children:t.fileType?.startsWith("audio/")?(0,s.jsxs)("audio",{controls:!0,style:{maxWidth:"200px"},children:[s.jsx("source",{src:`/${t.fileUrl}`,type:t.fileType}),"Your browser does not support the audio element."]}):t.fileType?.startsWith("image/")?s.jsx("img",{src:`/${t.fileUrl}`,alt:t.fileName,style:{maxWidth:"200px",maxHeight:"200px",borderRadius:"8px",marginTop:"8px"}}):(0,s.jsxs)(c.Z,{href:`/${t.fileUrl}`,target:"_blank",variant:"contained",size:"small",sx:{mt:1},children:["Download ",t.fileName]})})]})},t._id)}),s.jsx("div",{ref:U})]}),(0,s.jsxs)(n.Z,{component:"form",onSubmit:H,sx:{p:2,borderTop:1,borderColor:"divider"},children:[(0,s.jsxs)(n.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s.jsx("input",{type:"file",ref:P,onChange:e=>{e.target.files&&e.target.files.length>0&&Z(Array.from(e.target.files))},multiple:!0,style:{display:"none"}}),s.jsx(p.Z,{onClick:()=>P.current?.click(),size:"small",children:s.jsx(y(),{})}),s.jsx(p.Z,{size:"small",onClick:k.W2,children:s.jsx(b.Z,{})}),s.jsx(p.Z,{size:"small",onClick:()=>Y(!1),children:s.jsx(T(),{})}),s.jsx(p.Z,{size:"small",onClick:()=>Y(!0),children:s.jsx(R(),{})}),s.jsx(p.Z,{onClick:()=>C?W():O(),size:"small",className:"ps-0",color:C?"error":"default",children:C?s.jsx(j(),{}):s.jsx(g(),{})}),C&&s.jsx(l.Z,{variant:"caption",color:"error",children:`${Math.floor(E/60)}:${(E%60).toString().padStart(2,"0")}`}),s.jsx(u.Z,{fullWidth:!0,size:"small",value:h,onChange:e=>x(e.target.value),placeholder:"Type a message..."}),s.jsx(c.Z,{type:"submit",disabled:!h&&0===S.length,variant:"contained",endIcon:s.jsx(m(),{}),children:"Send"})]}),S&&S.length>0&&(0,s.jsxs)(l.Z,{variant:"caption",sx:{ml:1,mt:1},children:["Selected file: ",S.map(e=>e.name+" ")]})]})]})}[S,L,o,l,c,d,p,u]=E.then?(await E)():E,a()}catch(e){a(e)}})},91291:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(57077),s=r(20997);let i=(0,a.createSvgIcon)((0,s.jsx)("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7s.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71s-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9"}),"CallEnd")},2083:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(57077),s=r(20997);let i=(0,a.createSvgIcon)((0,s.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic")},82576:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(57077),s=r(20997);let i=(0,a.createSvgIcon)((0,s.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff")},4300:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(57077),s=r(20997);let i=(0,a.createSvgIcon)((0,s.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam")},4730:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var a=r(57077),s=r(20997);let i=(0,a.createSvgIcon)((0,s.jsx)("path",{d:"m21 6.5-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18zM3.27 2 2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73z"}),"VideocamOff")},4288:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>v});var s=r(16689);r(580);var i=r(16593),n=r(73559),o=r.n(n),l=r(40655),c=r(58046),d=r(4529),p=r(89262),u=r(36522),h=r(52314),m=r(98840),x=r(20997),y=e([i,c]);[i,c]=y.then?(await y)():y;let f=e=>{let{classes:t,inset:r,primary:a,secondary:s,dense:i}=e;return o()({root:["root",r&&"inset",i&&"dense",a&&s&&"multiline"],primary:["primary"],secondary:["secondary"]},h.L,t)},g=(0,p.ZP)("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[{[`& .${h.Z.primary}`]:t.primary},{[`& .${h.Z.secondary}`]:t.secondary},t.root,r.inset&&t.inset,r.primary&&r.secondary&&t.multiline,r.dense&&t.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${l.Z.root}:where(& .${h.Z.primary})`]:{display:"block"},[`.${l.Z.root}:where(& .${h.Z.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),v=s.forwardRef(function(e,t){let r=(0,u.i)({props:e,name:"MuiListItemText"}),{children:a,className:n,disableTypography:o=!1,inset:l=!1,primary:p,primaryTypographyProps:h,secondary:y,secondaryTypographyProps:v,slots:j={},slotProps:S={},...Z}=r,{dense:w}=s.useContext(d.Z),b=null!=p?p:a,k=y,C={...r,disableTypography:o,inset:l,primary:!!b,secondary:!!k,dense:w},T=f(C),I={slots:j,slotProps:{primary:h,secondary:v,...S}},[R,L]=(0,m.Z)("primary",{className:T.primary,elementType:c.Z,externalForwardedProps:I,ownerState:C}),[M,E]=(0,m.Z)("secondary",{className:T.secondary,elementType:c.Z,externalForwardedProps:I,ownerState:C});return null==b||b.type===c.Z||o||(b=(0,x.jsx)(R,{variant:w?"body2":"body1",component:L?.variant?void 0:"span",...L,children:b})),null==k||k.type===c.Z||o||(k=(0,x.jsx)(M,{variant:"body2",color:"textSecondary",...E,children:k})),(0,x.jsxs)(g,{className:(0,i.default)(T.root,n),ownerState:C,ref:t,...Z,children:[b,k]})});a()}catch(e){a(e)}})},6814:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>p});var s=r(20997);r(86764),r(89090);var i=r(43291),n=r(7120),o=r(38890),l=r.n(o),c=r(41649),d=e([i,n]);[i,n]=d.then?(await d)():d;let p=function({Component:e,pageProps:{session:t,...r}}){return s.jsx(c.SessionProvider,{session:t,children:(0,s.jsxs)(i.Provider,{store:n.h,children:[s.jsx(l(),{options:{showSpinner:!1},color:"#F8CA15",height:4}),s.jsx(e,{...r})]})})};a()}catch(e){a(e)}})},87983:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var a=r(16689);class s{constructor(){this.peer=null}async initPeer(){}async getAnswer(e){if(this.peer)try{await this.peer.setRemoteDescription(new RTCSessionDescription(e));let t=await this.peer.createAnswer();return await this.peer.setLocalDescription(t),t}catch(e){throw console.error("Error creating answer:",e),e}}async setLocalDescription(e){if(this.peer)try{("stable"===this.peer.signalingState||"have-local-offer"===this.peer.signalingState)&&await this.peer.setRemoteDescription(new RTCSessionDescription(e))}catch(e){throw console.error("Error setting remote description:",e),e}}async getOffer(){if(this.peer){let e=await this.peer.createOffer();return await this.peer.setLocalDescription(new RTCSessionDescription(e)),e}}}let i=new s;function n(){let[e,t]=(0,a.useState)(!1);return e?i:null}},50902:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{ZP:()=>d,kS:()=>c});var s=r(73258),i=e([s]);s=(i.then?(await i)():i)[0];let n=(0,s.createAsyncThunk)("auth/login",async e=>{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw Error(r.message);return localStorage.setItem("token",r.token),r}),o=(0,s.createAsyncThunk)("auth/fetchUser",async()=>{let e=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=await e.json();if(!e.ok)throw Error(t.message);return t}),l=(0,s.createSlice)({name:"auth",initialState:{token:null,user:null,isLoading:!1,error:null},reducers:{logout:e=>{e.token=null,e.user=null,localStorage.removeItem("token"),localStorage.removeItem("user")}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,t)=>{e.isLoading=!1,e.token=t.payload.token,e.user=t.payload.user}).addCase(n.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Login failed"}).addCase(o.fulfilled,(e,t)=>{e.user=t.payload})}}),{logout:c}=l.actions,d=l.reducer;a()}catch(e){a(e)}})},7120:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{h:()=>o});var s=r(73258),i=r(50902),n=e([s,i]);[s,i]=n.then?(await n)():n;let o=(0,s.configureStore)({reducer:{auth:i.ZP}});a()}catch(e){a(e)}})},9530:(e,t,r)=>{"use strict";r.d(t,{Gm:()=>l,I9:()=>c,Sk:()=>n,W2:()=>i,bJ:()=>o,iO:()=>d});var a=r(32245),s=r.n(a);let i=async()=>{try{let e=await navigator.permissions.query({name:"microphone"});if("denied"===e.state){alert("Please allow microphone access in your browser settings to use this feature.");return}let t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind),r=document.createElement("dialog");r.style.padding="20px",r.style.borderRadius="8px",r.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)";let a=document.createElement("button");a.innerHTML="✕",a.style.position="absolute",a.style.right="10px",a.style.top="10px",a.style.border="none",a.style.background="none",a.style.fontSize="20px",a.style.cursor="pointer",a.onclick=()=>r.close(),r.appendChild(a);let s=document.createElement("h3");s.textContent="Select Audio Device",r.appendChild(s);let i=document.createElement("select");i.style.width="100%",i.style.padding="8px",i.style.marginBottom="10px",t.forEach(e=>{let t=document.createElement("option");t.value=e.deviceId,t.text=e.label||`Microphone ${e.deviceId.slice(0,5)}`,i.appendChild(t)});let n=document.createElement("button");n.textContent="Save Selection",n.style.padding="8px 16px",n.onclick=()=>{localStorage.setItem("preferredMicrophoneId",i.value),r.close()},r.appendChild(i),r.appendChild(n),document.body.appendChild(r),r.showModal()}catch(e){console.error("Error accessing media devices:",e),alert("Unable to access microphone. Please check your browser settings.")}},n=e=>{let t=new Blob([e],{type:e.type});return URL.createObjectURL(t)},o=(e,t)=>e.reduce((e,r)=>e+parseInt(r[t]),0),l=e=>{let t="00",r="00",a="00";if(e){let s=Math.floor(e.asSeconds());t=Math.floor(s/3600).toString().padStart(2,"0"),r=Math.floor(s%3600/60).toString().padStart(2,"0"),a=Math.floor(s%60).toString().padStart(2,"0")}return`${t}:${r}:${a}`},c=(e,t)=>{let[r,a]=t.split(":"),i=s()(e).add(Number(r),"hours").add(Number(a),"minutes"),n=s()(),o=s().duration(i.diff(n));return 0>o.asSeconds()&&(o=s().duration(0)),console.log("Current time:",i.format()),o},d=e=>1===e?"1st":2===e?"2nd":3===e?"3rd":`${e}th`},86764:()=>{}};